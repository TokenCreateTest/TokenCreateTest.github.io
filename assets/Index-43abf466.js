import{D as G}from"./Dialog-e8cd0be3.js";import{d as j,f as q,b as z,g as b,B as J,r as C,o as E,k as Q,l as F,w as I,u as X,n as t,C as $,D as g,E as M,a as c,t as v,c as D,v as Y}from"./index-cc853d14.js";import{E as P,M as Z}from"./ERC20ABI-8ebaa2cb.js";import{u as ee}from"./create-13604832.js";import{_ as ae}from"./SvgIcon-08ae119a.js";import{B as k}from"./bignumber-3e8dfdf6.js";import{f as U,p as h}from"./units-d2150186.js";/* empty css                                                       */const oe={class:"van-dialog__header"},te={class:"van-dialog__content"},se={class:"van-dialog__message van-dialog__message--has-title"},ne={style:{paddingTop:"20px"}},re={class:"create-success-title"},le={class:"create-success-text"},ie={class:"create-success-text"},ve={__name:"Index",setup(ce){const{t:o}=j(),W=q(),l=z(),e=ee(),y=b(!1),A=b(!1),_=b(!1),T=b(!1),S=b(!1),B=b(!1),x=b(""),N=b("");async function O(){T.value=!0;try{const n=await new $(window.ethereum).getSigner();let r=await new g(l.tokenFactoryAddress,M,n).baseFeeToken();console.log("baseFeeTokenAddress",r),(await(await new g(r,P,n).approve(l.tokenFactoryAddress,Z)).wait()).status===1&&(t({type:"success",message:o("upChainSuccessfully")}),_.value=!1)}catch(a){console.log(a),a.info&&a.info.error&&a.info.error.code===4001?t(o("userCancelOperate")):a.error&&a.error.message&&a.error.message=="Canceled"?t(o("userCancelOperate")):t(o("unkonwError"))}finally{T.value=!1}}async function V(){if(console.log("createTokenClick"),l.chainId==-1){l.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1){if(!e.name){t(o("pleaseEnterName"));return}if(!e.symbol){t(o("pleaseEnterSymbol"));return}if(!e.totalSupply){t(o("pleaseEnterTotal"));return}}if(e.deployerId===1){if(!e.token){t(o("pleaseSelectCurrency"));return}if(!e.chainSwap){t(o("pleaseSelectSwap"));return}if(k(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){t(o("taxMustGt0"));return}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){t(o("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(e.fundAddress)){t(o("pleaseEnterTrueAddress"));return}if(console.log(!e.killBlock),console.log(!e.killBlock||Number(e.killBlock)<=0),e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){t(o("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){t(o("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){t(o("pleaseEnterMaxSwapLimit"));return}}S.value=!0;const n=await new $(window.ethereum).getSigner(),u=new g(l.tokenFactoryAddress,M,n);let r=await u.baseFee();console.log("baseFee",r);let f=await u.baseFeeToken();console.log("baseFeeTokenAddress",f);const d=new g(f,P,n),m=await d.decimals();N.value=await d.symbol(),x.value=U(r,m);const p=await d.allowance(l.walletAddress,l.tokenFactoryAddress);console.log("allowance",p),p<r?_.value=!0:_.value=!1,y.value=!0,S.value=!1}async function H(){B.value=!0;try{const n=await new $(window.ethereum).getSigner(),u=new g(l.tokenFactoryAddress,M,n);let r=await u.baseFee();console.log("baseFee",r);let f=await u.baseFeeToken();console.log("baseFeeToken",f);const d=new g(f,P,n),m=await d.decimals();N.value=await d.symbol(),x.value=U(r,m);const p=[],w=[],s=[],i=[];e.deployerId==0?(p[0]=e.name,p[1]=e.symbol,s[0]=e.decimals,s[1]=h(e.totalSupply,e.decimals),i[0]=e.canMint):e.deployerId==1&&(p[0]=e.name,p[1]=e.symbol,w[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:l.chainCoinWrappedAddress,w[1]=e.chainSwap.routerAddress,w[2]=l.walletAddress,w[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",s[0]=e.decimals,s[1]=h(e.totalSupply,e.decimals),s[2]=k(e.buyFundFee).times(100).toNumber(),s[3]=k(e.buyBurnFee).times(100).toNumber(),s[4]=k(e.buyLPFee).times(100).toNumber(),s[5]=k(e.sellFundFee).times(100).toNumber(),s[6]=k(e.sellBurnFee).times(100).toNumber(),s[7]=k(e.sellLPFee).times(100).toNumber(),s[8]=e.killBlock?k(e.killBlock).toNumber():0,s[9]=e.maxSwapAmount?h(e.maxSwapAmount,e.decimals):0n,s[10]=e.maxWalletAmount?h(e.maxWalletAmount,e.decimals):0n,i[0]=e.canMint,i[1]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",i[2]=e.enableManualStartTrade,i[3]=e.enableKillBlock,i[4]=e.enableSwapLimit,i[5]=e.enableWalletLimit,i[6]=e.enableChangeTax,i[7]=e.enableWhiteList),console.log(e.deployerId,p,w,s,i);const L=await u.tokenCreate(e.deployerId,p,w,s,i);console.dir(L),e.txHash=L.hash,L.wait().then(async R=>{R.status===1&&t({type:"success",message:o("upChainSuccessfully")})}),A.value=!0}catch(a){console.log(a),a.info&&a.info.error&&a.info.error.code===4001?t(o("userCancelOperate")):a.error&&a.error.message&&a.error.message=="Canceled"?t(o("userCancelOperate")):t(o("unkonwError"))}finally{y.value=!1,B.value=!1}}function K(){window.open(l.txNetwork+e.txHash,"_blank")}return J(()=>{console.log("create before mounted"),e.$reset(),W.push("/create/BasicInfo")}),(a,n)=>{const u=C("router-view"),r=C("van-action-bar-button"),f=C("van-action-bar"),d=C("van-popup");return E(),Q("div",null,[F(u,{onCreateTokenClick:V,createTokenLoading:S.value},null,8,["createTokenLoading"]),F(d,{show:y.value,"onUpdate:show":n[0]||(n[0]=m=>y.value=m),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:I(()=>[c("div",oe,v(a.$t("tokenCreationSoon")),1),c("div",te,[c("div",se,[c("div",null,v(a.$t("createConfirmInfo")),1),c("div",ne,v(a.$t("serviceFeeCreation",{baseFeeAmount:x.value,baseFeeSymbol:N.value.toUpperCase()})),1)])]),F(f,{class:"van-dialog__footer"},{default:I(()=>[_.value?(E(),D(r,{key:0,type:"danger",text:a.$t("approveFirst"),class:"van-dialog__confirm",loading:T.value,onClick:O},null,8,["text","loading"])):(E(),D(r,{key:1,type:"danger",loading:B.value,color:"#3F80F7",text:a.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:H},null,8,["loading","text"]))]),_:1})]),_:1},8,["show"]),F(G,{show:A.value,"onUpdate:show":n[1]||(n[1]=m=>A.value=m),theme:"round-button",showCancelButton:!1,confirmButtonText:a.$t("enterTokenManagement"),onOnConfirm:n[2]||(n[2]=m=>X(W).push("/"))},{default:I(()=>[c("div",null,[F(ae,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),c("div",re,v(a.$t("createdSubmitted")),1),c("div",le,[Y(v(a.$t("inBrowser")),1),c("span",{class:"show",onClick:K},v(a.$t("view")),1)]),c("div",ie,v(a.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{ve as default};
