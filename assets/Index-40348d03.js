import{D as q}from"./Dialog-2d7a7a87.js";import{_ as z,d as J,f as K,b as Q,g as p,B as W,r as g,o as y,k as X,l as m,w as _,u as Y,c as $,v as M,t as v,C as Z,a as l,D as B,E as w,G as E,n as r,H as O,I as ee}from"./index-bc429cca.js";import{E as D,M as oe}from"./ERC20ABI-8ebaa2cb.js";import{u as ae}from"./create-03e209d6.js";import{_ as te}from"./SvgIcon-10617073.js";/* empty css                                                       */const se={class:"van-dialog__header"},ne={class:"van-dialog__content"},re={class:"van-dialog__message van-dialog__message--has-title"},le={style:{paddingTop:"20px"}},ce={class:"create-success-title"},ie={class:"create-success-text"},de={class:"create-success-text"},ue={__name:"Index",setup(pe){const{t:s}=J(),P=K(),c=Q(),o=ae(),b=p(!1),C=p(!1),k=p(!1),h=p(!1),F=p(!1),T=p(!1),S=p(""),A=p("");async function H(){console.log("test...")}async function V(){h.value=!0;try{const a=await new B(window.ethereum).getSigner();let n=await new w(c.tokenFactoryAddress,E,a).baseFeeToken();console.log("baseFeeTokenAddress",n),(await(await new w(n,D,a).approve(c.tokenFactoryAddress,oe)).wait()).status===1&&(r({type:"success",message:s("upChainSuccessfully")}),k.value=!1)}catch(e){console.log(e),e.info&&e.info.error&&e.info.error.code===4001?r(s("userCancelOperate")):e.error&&e.error.message&&e.error.message=="Canceled"?r(s("userCancelOperate")):r(s("unkonwError"))}finally{h.value=!1}}async function L(){if(c.chainId==-1){c.netErrorDialogShow=!0;return}if(o.deployerId===0){if(!o.name){r(s("pleaseEnterName"));return}if(!o.symbol){r(s("pleaseEnterSymbol"));return}if(!o.totalSupply){r(s("pleaseEnterTotal"));return}}F.value=!0;const a=await new B(window.ethereum).getSigner(),i=new w(c.tokenFactoryAddress,E,a);let n=await i.baseFee();console.log("baseFee",n);let d=await i.baseFeeToken();console.log("baseFeeTokenAddress",d);const u=new w(d,D,a),f=await u.decimals();A.value=await u.symbol(),S.value=O(n,f);const t=await u.allowance(c.walletAddress,c.tokenFactoryAddress);console.log("allowance",t),t<n?k.value=!0:k.value=!1,b.value=!0,F.value=!1}async function R(){T.value=!0;try{const a=await new B(window.ethereum).getSigner(),i=new w(c.tokenFactoryAddress,E,a);let n=await i.baseFee();console.log("baseFee",n);let d=await i.baseFeeToken();console.log("baseFeeToken",d);const u=new w(d,D,a),f=await u.decimals();A.value=await u.symbol(),S.value=O(n,f);const t=[],N=[],x=[],U=[];o.deployerId==0&&(t[0]=o.name,t[1]=o.symbol,x[0]=o.decimals,x[1]=ee(o.totalSupply,o.decimals),U[0]=o.canMint);const I=await i.tokenCreate(o.deployerId,t,N,x,U);console.dir(I),o.txHash=I.hash,I.wait().then(async j=>{j.status===1&&r({type:"success",message:s("upChainSuccessfully")})}),C.value=!0}catch(e){console.log(e),e.info&&e.info.error&&e.info.error.code===4001?r(s("userCancelOperate")):e.error&&e.error.message&&e.error.message=="Canceled"?r(s("userCancelOperate")):r(s("unkonwError"))}finally{b.value=!1,T.value=!1}}function G(){window.open(c.txNetwork+o.txHash,"_blank")}return W(()=>{console.log("create before mounted"),o.$reset()}),(e,a)=>{const i=g("van-button"),n=g("router-view"),d=g("van-action-bar-button"),u=g("van-action-bar"),f=g("van-popup");return y(),X("div",null,[m(n,{onCreateToken:H},{default:_(({Component:t,Router:N})=>[(y(),$(Z(t),null,{create:_(()=>[m(i,{type:"primary",round:"",block:"",class:"btn-done",onClick:L,loading:F.value},{default:_(()=>[M(v(e.$t("create")),1)]),_:1},8,["loading"])]),_:2},1024))]),_:1}),m(f,{show:b.value,"onUpdate:show":a[0]||(a[0]=t=>b.value=t),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:_(()=>[l("div",se,v(e.$t("tokenCreationSoon")),1),l("div",ne,[l("div",re,[l("div",null,v(e.$t("createConfirmInfo")),1),l("div",le,v(e.$t("serviceFeeCreation",{baseFeeAmount:S.value,baseFeeSymbol:A.value.toUpperCase()})),1)])]),m(u,{class:"van-dialog__footer"},{default:_(()=>[k.value?(y(),$(d,{key:0,type:"danger",text:e.$t("approveFirst"),class:"van-dialog__confirm",loading:h.value,onClick:V},null,8,["text","loading"])):(y(),$(d,{key:1,type:"danger",loading:T.value,color:"#3F80F7",text:e.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:R},null,8,["loading","text"]))]),_:1})]),_:1},8,["show"]),m(q,{show:C.value,"onUpdate:show":a[1]||(a[1]=t=>C.value=t),theme:"round-button",showCancelButton:!1,confirmButtonText:e.$t("enterTokenManagement"),onOnConfirm:a[2]||(a[2]=t=>Y(P).push("/"))},{default:_(()=>[l("div",null,[m(te,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),l("div",ce,v(e.$t("createdSubmitted")),1),l("div",ie,[M(v(e.$t("inBrowser")),1),l("span",{class:"show",onClick:G},v(e.$t("view")),1)]),l("div",de,v(e.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}},be=z(ue,[["__scopeId","data-v-535daaee"]]);export{be as default};
