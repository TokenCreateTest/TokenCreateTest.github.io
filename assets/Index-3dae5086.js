import{D as G}from"./Dialog-1decf19a.js";import{d as j,f as q,b as z,g as w,B as J,r as S,o as L,k as Q,l as g,w as E,u as X,n as t,C as M,D as y,E as W,a as m,t as v,c as U,v as Y}from"./index-fc495694.js";import{E as $,M as Z}from"./ERC20ABI-8ebaa2cb.js";import{u as ee}from"./create-2da85b8e.js";import{_ as ae}from"./SvgIcon-b63b764c.js";import{B as r}from"./bignumber-3e8dfdf6.js";import{f as P,p as F}from"./units-ba798eac.js";/* empty css                                                       */const oe={class:"van-dialog__header"},te={class:"van-dialog__content"},se={class:"van-dialog__message van-dialog__message--has-title"},ne={style:{paddingTop:"20px"}},le={class:"create-success-title"},re={class:"create-success-text"},ie={class:"create-success-text"},ve={__name:"Index",setup(ce){const{t:s}=j(),D=q(),i=z(),e=ee(),h=w(!1),x=w(!1),A=w(!1),T=w(!1),B=w(!1),N=w(!1),C=w(""),_=w("");async function O(){T.value=!0;try{const l=await new M(window.ethereum).getSigner();let c=await new y(i.tokenFactoryAddress,W,l).baseFeeToken();console.log("baseFeeTokenAddress",c),(await(await new y(c,$,l).approve(i.tokenFactoryAddress,Z)).wait()).status===1&&(t({type:"success",message:s("upChainSuccessfully")}),A.value=!1)}catch(a){console.log(a),a.info&&a.info.error&&a.info.error.code===4001?t(s("userCancelOperate")):a.error&&a.error.message&&a.error.message=="Canceled"?t(s("userCancelOperate")):t(s("unkonwError"))}finally{T.value=!1}}async function K(){if(console.log("createTokenClick"),i.chainId==-1){i.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){t(s("pleaseEnterName"));return}if(!e.symbol){t(s("pleaseEnterSymbol"));return}if(!e.totalSupply){t(s("pleaseEnterTotal"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){t(s("pleaseSelectCurrency"));return}if(!e.chainSwap){t(s("pleaseSelectSwap"));return}if(e.deployerId===1){if(r(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){t(s("taxMustGt0"));return}}else if(e.deployerId===2&&r(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){t("营销费率和回流费率之和必须大于0");return}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){t(s("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(e.fundAddress)){t(s("pleaseEnterTrueAddress"));return}if(console.log(!e.killBlock),console.log(!e.killBlock||Number(e.killBlock)<=0),e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){t(s("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){t(s("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){t(s("pleaseEnterMaxSwapLimit"));return}}B.value=!0;const l=await new M(window.ethereum).getSigner(),p=new y(i.tokenFactoryAddress,W,l);let c=await p.baseFee();console.log("baseFee",c);let k=await p.baseFeeToken();console.log("baseFeeTokenAddress",k);const f=new y(k,$,l),b=await f.decimals();_.value=await f.symbol(),C.value=P(c,b);const d=await f.allowance(i.walletAddress,i.tokenFactoryAddress);console.log("allowance",d),d<c?A.value=!0:A.value=!1,h.value=!0,B.value=!1}async function R(){N.value=!0;try{const l=await new M(window.ethereum).getSigner(),p=new y(i.tokenFactoryAddress,W,l);let c=await p.baseFee();console.log("baseFee",c);let k=await p.baseFeeToken();console.log("baseFeeToken",k);const f=new y(k,$,l),b=await f.decimals();_.value=await f.symbol(),C.value=P(c,b);const d=[],u=[],o=[],n=[];e.deployerId==0?(d[0]=e.name,d[1]=e.symbol,o[0]=e.decimals,o[1]=F(e.totalSupply,e.decimals),n[0]=e.canMint):e.deployerId==1?(d[0]=e.name,d[1]=e.symbol,u[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:i.chainCoinWrappedAddress,u[1]=e.chainSwap.routerAddress,u[2]=i.walletAddress,u[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",o[0]=e.decimals,o[1]=F(e.totalSupply,e.decimals),o[2]=r(e.buyFundFee).times(100).toNumber(),o[3]=r(e.buyBurnFee).times(100).toNumber(),o[4]=r(e.buyLPFee).times(100).toNumber(),o[5]=r(e.sellFundFee).times(100).toNumber(),o[6]=r(e.sellBurnFee).times(100).toNumber(),o[7]=r(e.sellLPFee).times(100).toNumber(),o[8]=e.killBlock?r(e.killBlock).toNumber():0,o[9]=e.maxSwapAmount?F(e.maxSwapAmount,e.decimals):0n,o[10]=e.maxWalletAmount?F(e.maxWalletAmount,e.decimals):0n,n[0]=e.canMint,n[1]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",n[2]=e.enableManualStartTrade,n[3]=e.enableKillBlock,n[4]=e.enableSwapLimit,n[5]=e.enableWalletLimit,n[6]=e.enableChangeTax,n[7]=e.enableWhiteList):e.deployerId==2&&(d[0]=e.name,d[1]=e.symbol,u[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:i.chainCoinWrappedAddress,u[1]=e.chainSwap.routerAddress,u[2]=i.walletAddress,u[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",o[0]=e.decimals,o[1]=F(e.totalSupply,e.decimals),o[2]=r(e.buyFundFee).times(100).toNumber(),o[3]=r(e.buyRewardFee).times(100).toNumber(),o[4]=r(e.buyLPFee).times(100).toNumber(),o[5]=r(e.sellFundFee).times(100).toNumber(),o[6]=r(e.sellRewardFee).times(100).toNumber(),o[7]=r(e.sellLPFee).times(100).toNumber(),o[8]=e.killBlock?r(e.killBlock).toNumber():0,o[9]=e.maxSwapAmount?F(e.maxSwapAmount,e.decimals):0n,o[10]=e.maxWalletAmount?F(e.maxWalletAmount,e.decimals):0n,n[0]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",n[1]=e.enableManualStartTrade,n[2]=e.enableKillBlock,n[3]=e.enableSwapLimit,n[4]=e.enableWalletLimit,n[5]=e.enableChangeTax,n[6]=e.enableWhiteList),console.log(e.deployerId,d,u,o,n);const I=await p.tokenCreate(e.deployerId,d,u,o,n);console.dir(I),e.txHash=I.hash,I.wait().then(async H=>{H.status===1&&t({type:"success",message:s("upChainSuccessfully")})}),x.value=!0}catch(a){if(console.log(a),a.info&&a.info.error&&a.info.error.code===4001)t(s("userCancelOperate"));else if(a.error&&a.error.message&&a.error.message=="Canceled")t(s("userCancelOperate"));else if(a.data&&a.data.code==-32e3){const l=a.data.message.match(/(\d+) want (\d+)/)[2];t(s("balanceSlow2",{chainMianCoin:i.token.chainCoinSymbol,amount:P(l)}))}else a.code==="INSUFFICIENT_FUNDS"?t(s("balanceSlow")):a.info&&a.info.error&&a.info.error.code==-32603?t(s("balanceSlow2",{chainMianCoin:_.value,amount:C.value})):t(s("unkonwError"))}finally{h.value=!1,N.value=!1}}function V(){window.open(i.txNetwork+e.txHash,"_blank")}return J(()=>{console.log("create before mounted"),e.$reset(),D.push("/create/BasicInfo")}),(a,l)=>{const p=S("router-view"),c=S("van-action-bar-button"),k=S("van-action-bar"),f=S("van-popup");return L(),Q("div",null,[g(p,{onCreateTokenClick:K,createTokenLoading:B.value},null,8,["createTokenLoading"]),g(f,{show:h.value,"onUpdate:show":l[0]||(l[0]=b=>h.value=b),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:E(()=>[m("div",oe,v(a.$t("tokenCreationSoon")),1),m("div",te,[m("div",se,[m("div",null,v(a.$t("createConfirmInfo")),1),m("div",ne,v(a.$t("serviceFeeCreation",{baseFeeAmount:C.value,baseFeeSymbol:_.value.toUpperCase()})),1)])]),g(k,{class:"van-dialog__footer"},{default:E(()=>[A.value?(L(),U(c,{key:0,type:"danger",text:a.$t("approveFirst"),class:"van-dialog__confirm",loading:T.value,onClick:O},null,8,["text","loading"])):(L(),U(c,{key:1,type:"danger",loading:N.value,color:"#3F80F7",text:a.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:R},null,8,["loading","text"]))]),_:1})]),_:1},8,["show"]),g(G,{show:x.value,"onUpdate:show":l[1]||(l[1]=b=>x.value=b),theme:"round-button",showCancelButton:!1,confirmButtonText:a.$t("enterTokenManagement"),onOnConfirm:l[2]||(l[2]=b=>X(D).push("/"))},{default:E(()=>[m("div",null,[g(ae,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),m("div",le,v(a.$t("createdSubmitted")),1),m("div",re,[Y(v(a.$t("inBrowser")),1),m("span",{class:"show",onClick:V},v(a.$t("view")),1)]),m("div",ie,v(a.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{ve as default};
