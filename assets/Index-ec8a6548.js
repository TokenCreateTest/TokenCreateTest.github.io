import{D as G}from"./Dialog-ef2c1a93.js";import{e as j,g as q,d as z,h as w,C as J,r as h,o as I,l as Q,m as g,w as E,u as X,p as t,D as W,E as y,G as $,b as m,t as v,a as D,x as Y}from"./index-736b0d16.js";import{E as P,M as Z}from"./ERC20ABI-8ebaa2cb.js";import{u as ee}from"./create-bdd68b94.js";import{_ as ae}from"./SvgIcon-3d78548a.js";import{B as l}from"./bignumber-3e8dfdf6.js";import{f as U,p as F}from"./units-bacceeeb.js";/* empty css                                                       */const oe={class:"van-dialog__header"},te={class:"van-dialog__content"},se={class:"van-dialog__message van-dialog__message--has-title"},ne={style:{paddingTop:"20px"}},le={class:"create-success-title"},re={class:"create-success-text"},ie={class:"create-success-text"},ve={__name:"Index",setup(ce){const{t:s}=j(),M=q(),i=z(),e=ee(),A=w(!1),C=w(!1),_=w(!1),S=w(!1),x=w(!1),T=w(!1),B=w(""),N=w("");async function O(){S.value=!0;try{const r=await new W(window.ethereum).getSigner();let c=await new y(i.tokenFactoryAddress,$,r).baseFeeToken();console.log("baseFeeTokenAddress",c),(await(await new y(c,P,r).approve(i.tokenFactoryAddress,Z)).wait()).status===1&&(t({type:"success",message:s("upChainSuccessfully")}),_.value=!1)}catch(a){console.log(a),a.info&&a.info.error&&a.info.error.code===4001?t(s("userCancelOperate")):a.error&&a.error.message&&a.error.message=="Canceled"?t(s("userCancelOperate")):t(s("unkonwError"))}finally{S.value=!1}}async function K(){if(console.log("createTokenClick"),i.chainId==-1){i.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){t(s("pleaseEnterName"));return}if(!e.symbol){t(s("pleaseEnterSymbol"));return}if(!e.totalSupply){t(s("pleaseEnterTotal"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){t(s("pleaseSelectCurrency"));return}if(!e.chainSwap){t(s("pleaseSelectSwap"));return}if(e.deployerId===1){if(l(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){t(s("taxMustGt0"));return}}else if(e.deployerId===2&&l(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){t("营销费率和回流费率之和必须大于0");return}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){t(s("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(e.fundAddress)){t(s("pleaseEnterTrueAddress"));return}if(console.log(!e.killBlock),console.log(!e.killBlock||Number(e.killBlock)<=0),e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){t(s("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){t(s("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){t(s("pleaseEnterMaxSwapLimit"));return}}x.value=!0;const r=await new W(window.ethereum).getSigner(),p=new y(i.tokenFactoryAddress,$,r);let c=await p.baseFee();console.log("baseFee",c);let k=await p.baseFeeToken();console.log("baseFeeTokenAddress",k);const b=new y(k,P,r),f=await b.decimals();N.value=await b.symbol(),B.value=U(c,f);const d=await b.allowance(i.walletAddress,i.tokenFactoryAddress);console.log("allowance",d),d<c?_.value=!0:_.value=!1,A.value=!0,x.value=!1}async function R(){T.value=!0;try{const r=await new W(window.ethereum).getSigner(),p=new y(i.tokenFactoryAddress,$,r);let c=await p.baseFee();console.log("baseFee",c);let k=await p.baseFeeToken();console.log("baseFeeToken",k);const b=new y(k,P,r),f=await b.decimals();N.value=await b.symbol(),B.value=U(c,f);const d=[],u=[],o=[],n=[];e.deployerId==0?(d[0]=e.name,d[1]=e.symbol,o[0]=e.decimals,o[1]=F(e.totalSupply,e.decimals),n[0]=e.canMint):e.deployerId==1?(d[0]=e.name,d[1]=e.symbol,u[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:i.chainCoinWrappedAddress,u[1]=e.chainSwap.routerAddress,u[2]=i.walletAddress,u[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",o[0]=e.decimals,o[1]=F(e.totalSupply,e.decimals),o[2]=l(e.buyFundFee).times(100).toNumber(),o[3]=l(e.buyBurnFee).times(100).toNumber(),o[4]=l(e.buyLPFee).times(100).toNumber(),o[5]=l(e.sellFundFee).times(100).toNumber(),o[6]=l(e.sellBurnFee).times(100).toNumber(),o[7]=l(e.sellLPFee).times(100).toNumber(),o[8]=e.killBlock?l(e.killBlock).toNumber():0,o[9]=e.maxSwapAmount?F(e.maxSwapAmount,e.decimals):0n,o[10]=e.maxWalletAmount?F(e.maxWalletAmount,e.decimals):0n,n[0]=e.canMint,n[1]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",n[2]=e.enableManualStartTrade,n[3]=e.enableKillBlock,n[4]=e.enableSwapLimit,n[5]=e.enableWalletLimit,n[6]=e.enableChangeTax,n[7]=e.enableWhiteList):e.deployerId==2&&(d[0]=e.name,d[1]=e.symbol,u[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:i.chainCoinWrappedAddress,u[1]=e.chainSwap.routerAddress,u[2]=i.walletAddress,u[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",o[0]=e.decimals,o[1]=F(e.totalSupply,e.decimals),o[2]=l(e.buyFundFee).times(100).toNumber(),o[3]=l(e.buyRewardFee).times(100).toNumber(),o[4]=l(e.buyLPFee).times(100).toNumber(),o[5]=l(e.sellFundFee).times(100).toNumber(),o[6]=l(e.sellRewardFee).times(100).toNumber(),o[7]=l(e.sellLPFee).times(100).toNumber(),o[8]=e.killBlock?l(e.killBlock).toNumber():0,o[9]=e.maxSwapAmount?F(e.maxSwapAmount,e.decimals):0n,o[10]=e.maxWalletAmount?F(e.maxWalletAmount,e.decimals):0n,n[0]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",n[1]=e.enableManualStartTrade,n[2]=e.enableKillBlock,n[3]=e.enableSwapLimit,n[4]=e.enableWalletLimit,n[5]=e.enableChangeTax,n[6]=e.enableWhiteList),console.log(e.deployerId,d,u,o,n);const L=await p.tokenCreate(e.deployerId,d,u,o,n);console.dir(L),e.txHash=L.hash,L.wait().then(async H=>{H.status===1&&t({type:"success",message:s("upChainSuccessfully")})}),C.value=!0}catch(a){console.log(a),a.info&&a.info.error&&a.info.error.code===4001?t(s("userCancelOperate")):a.error&&a.error.message&&a.error.message=="Canceled"?t(s("userCancelOperate")):t(s("unkonwError"))}finally{A.value=!1,T.value=!1}}function V(){window.open(i.txNetwork+e.txHash,"_blank")}return J(()=>{console.log("create before mounted"),e.$reset(),M.push("/create/BasicInfo")}),(a,r)=>{const p=h("router-view"),c=h("van-action-bar-button"),k=h("van-action-bar"),b=h("van-popup");return I(),Q("div",null,[g(p,{onCreateTokenClick:K,createTokenLoading:x.value},null,8,["createTokenLoading"]),g(b,{show:A.value,"onUpdate:show":r[0]||(r[0]=f=>A.value=f),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:E(()=>[m("div",oe,v(a.$t("tokenCreationSoon")),1),m("div",te,[m("div",se,[m("div",null,v(a.$t("createConfirmInfo")),1),m("div",ne,v(a.$t("serviceFeeCreation",{baseFeeAmount:B.value,baseFeeSymbol:N.value.toUpperCase()})),1)])]),g(k,{class:"van-dialog__footer"},{default:E(()=>[_.value?(I(),D(c,{key:0,type:"danger",text:a.$t("approveFirst"),class:"van-dialog__confirm",loading:S.value,onClick:O},null,8,["text","loading"])):(I(),D(c,{key:1,type:"danger",loading:T.value,color:"#3F80F7",text:a.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:R},null,8,["loading","text"]))]),_:1})]),_:1},8,["show"]),g(G,{show:C.value,"onUpdate:show":r[1]||(r[1]=f=>C.value=f),theme:"round-button",showCancelButton:!1,confirmButtonText:a.$t("enterTokenManagement"),onOnConfirm:r[2]||(r[2]=f=>X(M).push("/"))},{default:E(()=>[m("div",null,[g(ae,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),m("div",le,v(a.$t("createdSubmitted")),1),m("div",re,[Y(v(a.$t("inBrowser")),1),m("span",{class:"show",onClick:V},v(a.$t("view")),1)]),m("div",ie,v(a.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{ve as default};
