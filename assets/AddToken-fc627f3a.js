import{D as V}from"./Dialog-0c66b8d0.js";import{_ as $,d as T,b as B,e as b,g as d,r as y,o as U,k as E,a as H,l as o,w as v,u as p,F as O,n as l,D as x,E as D,I as N,H as F,v as I,t as L}from"./index-27fe7498.js";import{u as M}from"./manage-35702ca3.js";import{c as W,f as P}from"./index-4a217fdd.js";/* empty css                                                       */const j={class:"add-token"},q={__name:"AddToken",setup(z){const{t:s}=T(),h=B(),n=M(),_=b(()=>h.walletAddress.toLowerCase()===n.owner.toLowerCase()),g=d(""),m=d(h.walletAddress),r=d(""),k=b(()=>s("operationHash",{hash:P(g.value)})),c=d(!1),w=d(!1);function A(t){return t.replace("-","")}async function S(){if(!r.value){l(s("amountWarn"));return}if(r.value.replace(".","").length>34){l("金额超限");return}let t=r.value.split(".");if(t[1]&&t[1].length>n.decimals){l("金额超限");return}if(!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(m.value)){l(s("addressWrong"));return}w.value=!0;try{const i=await new x(window.ethereum).getSigner(),u=new D(n.tokenAddress,n.abi,i);let f=await u.mint(m.value,N(r.value,n.decimals));g.value=f.hash,f.wait().then(async a=>{if(a.status===1){l({type:"success",message:s("upChainSuccessfully")});let C=await u.totalSupply();n.totalSupply=F(C.toString(),n.decimals)}}),c.value=!0}catch(e){console.log(e),e.info&&e.info.error&&e.info.error.code===4001?l(s("userCancelOperate")):e.error&&e.error.message&&e.error.message=="Canceled"?l(s("userCancelOperate")):l(s("unkonwError"))}finally{w.value=!1}}return(t,e)=>{const i=y("van-field"),u=y("van-cell-group"),f=y("van-button");return U(),E(O,null,[H("div",j,[o(u,{inset:""},{default:v(()=>[o(i,{modelValue:p(n).totalSupply,"onUpdate:modelValue":e[0]||(e[0]=a=>p(n).totalSupply=a),readonly:"",label:t.$t("currentTotal"),"input-align":"right"},null,8,["modelValue","label"])]),_:1}),o(u,{inset:""},{default:v(()=>[o(i,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),type:"number",label:t.$t("addTokenAmount"),placeholder:t.$t("pleaseEnter"),formatter:A,"input-align":"right"},null,8,["modelValue","label","placeholder"])]),_:1}),o(u,{inset:""},{default:v(()=>[o(i,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),"label-width":"9em",label:t.$t("receivingAddress"),placeholder:t.$t("pleaseEnter"),"input-align":"right"},null,8,["modelValue","label","placeholder"])]),_:1}),o(f,{type:"primary",round:"",block:"",class:"btn",onClick:S,loading:w.value,disabled:!p(_)},{default:v(()=>[I(L(t.$t("submitAdd")),1)]),_:1},8,["loading","disabled"])]),o(V,{show:c.value,"onUpdate:show":e[3]||(e[3]=a=>c.value=a),title:t.$t("submitAddSuccessfully"),message:p(k),cancelButtonText:t.$t("thinkAgain"),confirmButtonText:t.$t("copyHash"),onOnConfirm:e[4]||(e[4]=a=>p(W)(g.value)),onOnCancel:e[5]||(e[5]=a=>c.value=!1)},null,8,["show","title","message","cancelButtonText","confirmButtonText"])],64)}}},X=$(q,[["__scopeId","data-v-93f7345f"]]);export{X as default};
