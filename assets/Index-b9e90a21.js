import{D as K}from"./Dialog-c6b22cbf.js";import{d as V,f as H,b as G,g as p,B as X,r as C,o as B,k as j,l as F,w as L,u as q,n,C as I,D as y,E,a as c,t as b,c as W,v as z}from"./index-695464e2.js";import{E as M,M as J}from"./ERC20ABI-8ebaa2cb.js";import{u as Q}from"./create-2f00f818.js";import{_ as Y}from"./SvgIcon-bf159e15.js";import{B as l}from"./bignumber-3e8dfdf6.js";import{f as $,p as m}from"./units-fafae6c9.js";/* empty css                                                       */const Z={class:"van-dialog__header"},ee={class:"van-dialog__content"},ae={class:"van-dialog__message van-dialog__message--has-title"},te={style:{paddingTop:"20px"}},se={class:"create-success-title"},oe={class:"create-success-text"},ne={class:"create-success-text"},be={__name:"Index",setup(le){const{t:o}=V(),P=H(),d=G(),e=Q(),v=p(!1),x=p(!1),g=p(!1),S=p(!1),_=p(!1),T=p(!1),A=p(""),w=p("");async function R(){S.value=!0;try{const u=await new I(window.ethereum).getSigner();let i=await new y(d.tokenFactoryAddress,E,u).baseFeeToken();console.log("baseFeeTokenAddress",i),(await(await new y(i,M,u).approve(d.tokenFactoryAddress,J)).wait()).status===1&&(n({type:"success",message:o("upChainSuccessfully")}),g.value=!1)}catch(t){console.log(t),t.info&&t.info.error&&t.info.error.code===4001?n(o("userCancelOperate")):t.error&&t.error.message&&t.error.message=="Canceled"?n(o("userCancelOperate")):n(o("unkonwError"))}finally{S.value=!1}}async function U(){console.log("createTokenClick");const t=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(d.chainId==-1){d.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){n(o("pleaseEnterName"));return}if(!e.symbol){n(o("pleaseEnterSymbol"));return}if(!e.totalSupply){n(o("pleaseEnterTotal"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){n(o("pleaseSelectCurrency"));return}if(!e.chainSwap){n(o("pleaseSelectSwap"));return}if(e.deployerId===1){if(l(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){n(o("taxMustGt0"));return}}else if(e.deployerId===2){if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){n(o("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){n(o("dividendTokenError"));return}if(!t.test(e.rewardToken)){n(o("pleaseEnterTrueAddress"));return}if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){n(o("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){n(o("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!t.test(e.fundAddress)){n(o("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){n(o("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){n(o("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){n(o("pleaseEnterMaxSwapLimit"));return}}_.value=!0;const f=await new I(window.ethereum).getSigner(),i=new y(d.tokenFactoryAddress,E,f);let r=await i.baseFee();console.log("baseFee",r);let a=await i.baseFeeToken();console.log("baseFeeTokenAddress",a);const s=new y(a,M,f),k=await s.decimals();if(a.toLowerCase()==="0x9ebab27608bd64aff36f027049aecc69102a0d1e")w.value="USDT-lfgbridge";else{let N=await s.symbol();w.value=N.toUpperCase()}A.value=$(r,k);const h=await s.allowance(d.walletAddress,d.tokenFactoryAddress);console.log("allowance",h),h<r?g.value=!0:g.value=!1,v.value=!0,_.value=!1}async function D(){T.value=!0;try{const u=await new I(window.ethereum).getSigner(),f=new y(d.tokenFactoryAddress,E,u),i=[],r=[],a=[],s=[];e.deployerId==0?(i[0]=e.name,i[1]=e.symbol,a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),s[0]=e.canMint):e.deployerId==1?(i[0]=e.name,i[1]=e.symbol,r[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:d.chainCoinWrappedAddress,r[1]=e.chainSwap.routerAddress,r[2]=d.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyBurnFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellBurnFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,e.decimals):0n,s[0]=e.canMint,s[1]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",s[2]=e.enableManualStartTrade,s[3]=e.enableKillBlock,s[4]=e.enableSwapLimit,s[5]=e.enableWalletLimit,s[6]=e.enableChangeTax,s[7]=e.enableWhiteList):e.deployerId==2?(i[0]=e.name,i[1]=e.symbol,r[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:d.chainCoinWrappedAddress,r[1]=e.chainSwap.routerAddress,r[2]=d.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,e.decimals):0n,s[0]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList):e.deployerId==3&&(i[0]=e.name,i[1]=e.symbol,r[0]=e.token.tokenAddress!=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"?e.token.tokenAddress:d.chainCoinWrappedAddress,r[1]=e.chainSwap.routerAddress,r[2]=d.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[4]=e.rewardToken,a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,e.decimals):0n,s[0]=e.token.tokenAddress==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList,s[7]=e.canMint),console.log(e.deployerId,i,r,a,s);const k=await f.tokenCreate(e.deployerId,i,r,a,s);console.dir(k),e.txHash=k.hash,k.wait().then(async h=>{h.status===1&&n({type:"success",message:o("upChainSuccessfully")})}),x.value=!0}catch(t){if(console.log(t),t.info&&t.info.error&&t.info.error.code===4001)n(o("userCancelOperate"));else if(t.error&&t.error.message&&t.error.message=="Canceled")n(o("userCancelOperate"));else if(t.data&&t.data.code==-32e3){const u=t.data.message.match(/(\d+) want (\d+)/)[2];n(o("balanceSlow2",{chainMianCoin:d.token.chainCoinSymbol,amount:$(u)}))}else t.code==="INSUFFICIENT_FUNDS"?n(o("balanceSlow")):t.info&&t.info.error&&t.info.error.code==-32603&&t.info.error.data.message==="execution reverted: BEP40: transfer amount exceeds balance"?n(o("balanceSlow2",{chainMianCoin:w.value,amount:A.value})):t.code=="CALL_EXCEPTION"&&t.info.error.message=="execution reverted: BEP40: transfer amount exceeds balance"?n(o("balanceSlow2",{chainMianCoin:w.value,amount:A.value})):n(o("unkonwError"))}finally{v.value=!1,T.value=!1}}function O(){window.open(d.txNetwork+e.txHash,"_blank")}return X(()=>{console.log("create before mounted"),e.$reset(),P.push("/create/BasicInfo")}),(t,u)=>{const f=C("router-view"),i=C("van-action-bar-button"),r=C("van-action-bar"),a=C("van-popup");return B(),j("div",null,[F(f,{onCreateTokenClick:U,createTokenLoading:_.value},null,8,["createTokenLoading"]),F(a,{show:v.value,"onUpdate:show":u[0]||(u[0]=s=>v.value=s),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:L(()=>[c("div",Z,b(t.$t("tokenCreationSoon")),1),c("div",ee,[c("div",ae,[c("div",null,b(t.$t("createConfirmInfo")),1),c("div",te,b(t.$t("serviceFeeCreation",{baseFeeAmount:A.value,baseFeeSymbol:w.value})),1)])]),F(r,{class:"van-dialog__footer"},{default:L(()=>[g.value?(B(),W(i,{key:0,type:"danger",text:t.$t("approveFirst"),class:"van-dialog__confirm",loading:S.value,onClick:R},null,8,["text","loading"])):(B(),W(i,{key:1,type:"danger",loading:T.value,color:"#3F80F7",text:t.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:D},null,8,["loading","text"]))]),_:1})]),_:1},8,["show"]),F(K,{show:x.value,"onUpdate:show":u[1]||(u[1]=s=>x.value=s),theme:"round-button",showCancelButton:!1,confirmButtonText:t.$t("enterTokenManagement"),onOnConfirm:u[2]||(u[2]=s=>q(P).push("/"))},{default:L(()=>[c("div",null,[F(Y,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),c("div",se,b(t.$t("createdSubmitted")),1),c("div",oe,[z(b(t.$t("inBrowser")),1),c("span",{class:"show",onClick:O},b(t.$t("view")),1)]),c("div",ne,b(t.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{be as default};
